# SGLang vs vLLM (Qwen) 성능 비교 보고서

## 📊 Qwen 스타일 벤치마크 결과

### 테스트 환경
- **하드웨어**: NVIDIA RTX 5090 (32GB VRAM)
- **모델**: Qwen3-32B-AWQ (4-bit 양자화)
- **비교 대상**:
  - vLLM with CPU offloading (기존 Qwen 배포)
  - SGLang Balanced-v2 (LOF 스케줄링 최적화)

## 🎯 주요 성능 개선

### 1. 토큰 생성 속도: +53.7% 개선
| 지표 | vLLM (기존) | SGLang | 개선율 |
|------|------------|--------|--------|
| **평균 속도** | 6.69 tok/s | 10.28 tok/s | **+53.7%** |

### 2. 응답 지연시간 개선
| 토큰 수 | vLLM (기존) | SGLang | 개선율 |
|---------|------------|--------|--------|
| 10 토큰 | 1.29초 | 0.97초 | **+24.8%** |
| 50 토큰 | 5.94초 | 4.87초 | **+18.0%** |
| 100 토큰 | 11.80초 | 9.73초 | **+17.5%** |
| 200 토큰 | 23.50초 | 19.47초 | **+17.1%** |
| 500 토큰 | 58.71초 | 48.70초 | **+17.0%** |

### 3. 동시 사용자 처리 능력
| 동시 사용자 | 처리량 개선 | 지연시간 개선 |
|------------|------------|--------------|
| 1명 | +23.5% | -18.2% |
| 2명 | +31.3% | -23.8% |
| 5명 | +53.6% | -34.3% |
| 10명 | **+82.6%** | **-45.0%** |
| 20명 | **+142.0%** | **-58.7%** |

## 📈 성능 개선 그래프

### 토큰 생성 속도 비교
```
vLLM:     ████████ 6.69 tok/s
SGLang:   ████████████████ 10.28 tok/s (+53.7%)
```

### 10명 동시 처리 성능
```
처리량:
vLLM:     ██████ 1.15 req/s
SGLang:   ███████████ 2.10 req/s (+82.6%)

지연시간:
vLLM:     ████████████████ 8.66s
SGLang:   █████████ 4.76s (-45.0%)
```

### 20명 동시 처리 성능
```
처리량:
vLLM:     █████ 1.74 req/s
SGLang:   ████████████ 4.21 req/s (+142.0%)

지연시간:
vLLM:     ████████████████████ 11.50s
SGLang:   ████████ 4.75s (-58.7%)
```

## 🔑 핵심 개선 사항

### 1. CPU Offloading 제거
- **Before (vLLM)**: CPU offloading으로 인한 성능 병목
- **After (SGLang)**: 전체 모델 GPU 메모리 적재

### 2. 최적화 기법 적용
- LOF (Least Outstanding First) 스케줄링
- Triton Attention Backend
- Torch Compile 활성화
- 연속 디코드 2 스텝

### 3. 메모리 효율성
- 정적 메모리 할당 87%
- AWQ 4-bit 양자화 최적 활용
- KV 캐시 최적화

## 💡 실제 사용 시 체감 개선

### 단일 사용자 시나리오
- **짧은 답변 (10 토큰)**: 1.29초 → 0.97초 (320ms 단축)
- **일반 답변 (50 토큰)**: 5.94초 → 4.87초 (1초 이상 단축)
- **긴 답변 (200 토큰)**: 23.5초 → 19.5초 (4초 단축)

### 다중 사용자 시나리오 (10명)
- **처리량**: 1.15 req/s → 2.10 req/s (거의 2배)
- **평균 대기 시간**: 8.66초 → 4.76초 (거의 절반)

### 고부하 시나리오 (20명)
- **처리량**: 1.74 req/s → 4.21 req/s (2.4배 향상)
- **평균 대기 시간**: 11.50초 → 4.75초 (59% 단축)

## 📊 데이터 출처

### 원본 데이터 파일
- `qwen_performance_summary.csv` - vLLM 성능 데이터
- `sglang_qwen_style_benchmark_20250916_155136.csv` - SGLang 성능 데이터
- `sglang_vs_qwen_comparison.csv` - 비교 분석 결과

### 테스트 스크립트
- `qwen_performance_test.py` - 원본 Qwen 테스트
- `sglang_qwen_style_benchmark.py` - SGLang 동일 조건 테스트

## 🏁 결론

SGLang Balanced-v2 최적화를 통해:

1. **토큰 생성 속도 53.7% 향상**
2. **모든 시나리오에서 17-59% 지연시간 감소**
3. **다중 사용자 처리 능력 82-142% 향상**
4. **평균 40.6% 전체 성능 개선**

특히 **다중 사용자 환경**에서 극적인 성능 향상을 보여, 실제 프로덕션 환경에서 큰 이점을 제공합니다.